## 📊 完整数据库表结构设计

### 1. **宠物档案表** `pet_profile`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键，宠物ID
pet_name           STRING       宠物昵称（如"毛球"）
pet_type           STRING       宠物类型（狗/猫等）
breed              STRING       品种
birth_date         DATE         出生日期
weight             FLOAT        体重（kg）
gender             STRING       性别（公/母）
owner_id           STRING       主人ID
created_at         DATETIME     创建时间
updated_at         DATETIME     更新时间
```

### 2. **喂食记录表** `feeding_records`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键
pet_id             STRING       宠物ID（外键）
record_time        DATETIME     记录时间
food_type          STRING       食物类型（狗粮/湿粮/零食等）
food_amount        FLOAT        喂食量（g）
amount_level       STRING       量级（标准量/半份/加量）
notes              TEXT         备注信息
created_at         DATETIME     创建时间
```

### 3. **遛宠记录表** `walking_records`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键
pet_id             STRING       宠物ID（外键）
start_time         DATETIME     开始时间
end_time           DATETIME     结束时间（可为空）
duration           INT          时长（分钟）
location           STRING       地理位置
distance           FLOAT        距离（km，可选）
weather            STRING       天气情况（可选）
notes              TEXT         备注（如行为异常）
created_at         DATETIME     创建时间
```

### 4. **排泄记录表** `excretion_records`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键
pet_id             STRING       宠物ID（外键）
record_time        DATETIME     记录时间
excretion_type     STRING       类型（排便/排尿）
status             STRING       状态（正常/异常）
abnormal_detail    STRING       异常详情（软便/干硬/带血等）
color              STRING       颜色描述（可选）
notes              TEXT         备注
created_at         DATETIME     创建时间
```

### 5. **提醒配置表** `reminder_config`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键
pet_id             STRING       宠物ID（外键）
reminder_type      STRING       提醒类型（feeding/walking/custom）
reminder_time      TIME         提醒时间（如 07:00:00）
repeat_days        STRING       重复日期（JSON数组，如 "[1,2,3,4,5,6,7]"）
is_enabled         BOOLEAN      是否启用
reminder_message   STRING       提醒文案（可自定义）
advance_minutes    INT          提前提醒分钟数（默认0）
created_at         DATETIME     创建时间
updated_at         DATETIME     更新时间
```

**示例数据：**
```json
{
  "id": "remind_001",
  "pet_id": "pet_001",
  "reminder_type": "feeding",
  "reminder_time": "07:00:00",
  "repeat_days": "[1,2,3,4,5,6,7]",  // 每天
  "is_enabled": true,
  "reminder_message": "该给毛球喂早饭啦～",
  "advance_minutes": 0
}
```

### 6. **提醒执行日志表** `reminder_logs`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键
reminder_id        STRING       提醒配置ID（外键）
pet_id             STRING       宠物ID（外键）
trigger_time       DATETIME     触发时间
reminder_type      STRING       提醒类型
is_sent            BOOLEAN      是否已发送
user_response      STRING       用户响应（已完成/忽略/延后）
created_at         DATETIME     创建时间
```

### 7. **健康咨询记录表** `health_consultations`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键
pet_id             STRING       宠物ID（外键）
consultation_time  DATETIME     咨询时间
user_question      TEXT         用户问题
symptoms           STRING       症状描述
ai_diagnosis       TEXT         AI 诊断建议
severity_level     STRING       严重程度（正常/观察/就医）
related_records    TEXT         关联的记录ID（JSON数组）
created_at         DATETIME     创建时间
```

### 8. **异常提醒触发表** `abnormal_alerts`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键
pet_id             STRING       宠物ID（外键）
alert_type         STRING       异常类型（no_excretion/no_walking等）
alert_time         DATETIME     提醒时间
alert_message      TEXT         提醒内容
hours_elapsed      INT          已过时长（小时）
is_resolved        BOOLEAN      是否已解决
resolved_at        DATETIME     解决时间
created_at         DATETIME     创建时间
```

### 9. **周报生成表** `weekly_reports`

```sql
字段名              类型          说明
-----------------------------------------------
id                 STRING       主键
pet_id             STRING       宠物ID（外键）
week_start_date    DATE         周起始日期
week_end_date      DATE         周结束日期
feeding_count      INT          喂食次数
walking_count      INT          遛宠次数
excretion_count    INT          排泄次数
health_score       INT          健康评分（1-100）
summary_text       TEXT         总结文本
suggestions        TEXT         建议
created_at         DATETIME     生成时间
```

## 🔗 数据表关系图

```plaintext
pet_profile (1)
    ├── (1:N) feeding_records
    ├── (1:N) walking_records
    ├── (1:N) excretion_records
    ├── (1:N) reminder_config
    ├── (1:N) health_consultations
    ├── (1:N) abnormal_alerts
    └── (1:N) weekly_reports

reminder_config (1)
    └── (1:N) reminder_logs
```

## 📝 Coze 数据库插件配置示例

在 Coze 中创建数据库时的配置：

```yaml
# 示例：创建 reminder_config 表
表名: reminder_config
主键: id
索引:
  - pet_id
  - reminder_time
  - is_enabled (过滤查询)

常用查询模板:
1. 获取某宠物的所有启用提醒:
   SELECT * FROM reminder_config 
   WHERE pet_id = {{pet_id}} AND is_enabled = true

2. 获取当前时间需要触发的提醒:
   SELECT * FROM reminder_config 
   WHERE is_enabled = true 
   AND reminder_time = {{current_time}}
   AND repeat_days LIKE '%{{current_day}}%'

3. 检查最近 24 小时是否有排泄记录:
   SELECT * FROM excretion_records 
   WHERE pet_id = {{pet_id}} 
   AND record_time > datetime('now', '-24 hours')
```

## 🎯 关键字段使用说明

### `repeat_days` 字段格式
```json
// 周一到周日用 1-7 表示
"[1,2,3,4,5,6,7]"  // 每天
"[1,2,3,4,5]"      // 工作日
"[6,7]"            // 周末
"[1,3,5]"          // 周一、三、五
```

  